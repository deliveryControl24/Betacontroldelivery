
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Registro y Facturación de Pedidos</title>
    <style>
        body { 
            font-family: 'Roboto', sans-serif; 
            background-color: #f5f5f5; 
            margin: 0; 
            padding: 20px; 
        }
        h1, h2 { 
            color: #333; 
            text-align: center; 
            margin-bottom: 10px; 
        }
        img.logo {
            display: block;
            margin: 0 auto 20px; 
            max-width: 100%; 
            height: auto; 
        }
        form, .card, table {
            width: 100%; 
            max-width: 600px; 
            margin: auto; 
            background-color: #fff; 
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            padding: 15px;
            margin-bottom: 20px;
            box-sizing: border-box; 
        }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 10px; border: 1px solid #ddd; text-align: left; }
        th { background-color: #f0f0f0; }
        button { 
            background-color: #6200ea; 
            color: #fff; 
            border: none; 
            padding: 10px; 
            border-radius: 4px; 
            cursor: pointer; 
            width: 100%; 
            transition: background-color 0.3s; 
            margin-top: 10px; 
        }
        button:hover { background-color: #3700b3; }
        input, select { 
            border: 1px solid #ccc; 
            border-radius: 4px; 
            padding: 10px; 
            width: 100%; 
            margin: 8px 0; 
            box-sizing: border-box; 
        }
        .statistics {
            text-align: center;
            margin-bottom: 20px;
        }
        @media (max-width: 600px) {
            button { padding: 8px; }
            th, td { padding: 8px; }
        }
    </style>
</head>
<body>

<img src="logo.jpg" alt="Logo" class="logo"> 

<h1>Sistema de Registro y Facturación de Pedidos</h1>
<h2 id="currentDay"></h2>

<div class="statistics">
    <h2>Estadísticas</h2>
    <p id="totalOrders">Total de Pedidos: 0</p>
    <p id="totalEarnings">Total Ganancias: 0 C$</p>
    <p id="mostActiveDeliveryPerson">Repartidor Más Activo: Ninguno</p>
</div>

<form id="orderForm">
    <h2>Registrar Nuevo Pedido</h2>
    <label>Referencia: <input type="text" id="pickup" required></label>
    <label>Costo de Delivery (C$): <input type="number" id="cash" min="0" required></label>
    <label>Nombre de Repartidor: 
        <input type="text" id="deliveryPersonInput" placeholder="Buscar Repartidor" required>
        <select id="deliveryPersonSelect" style="display: none;"></select>
    </label>
    <label>Tipo de Pedido: 
        <select id="orderType">
            <option value="">Seleccione un tipo de pedido (opcional)</option>
            <option value="normal">Pedidos Normales</option>
            <option value="promotion">Pedidos en Promoción o Descuento</option>
            <option value="freeDelivery">Delivery Gratis</option>
        </select>
    </label>
    <button type="submit">Añadir Pedido</button>
    <button type="button" onclick="clearAllOrders()">Limpiar/Borrar</button>
</form>

<h2>Guardar Repartidor</h2>
<form id="deliveryPersonForm">
    <label>Nombre de Repartidor: <input type="text" id="newDeliveryPersonName" required></label>
    <button type="button" onclick="addDeliveryPerson()">Añadir Repartidor</button>
</form>

<div id="deliveryPersonTablesContainer"></div>

<div id="totalEarningsDisplay">Total Ganancias: 0 C$</div>
<button onclick="calculateTotalEarnings()">Calcular Total Ganancias del Día</button>

<script>
    let orders = JSON.parse(localStorage.getItem('orders')) || [];
    let deliveryPersons = JSON.parse(localStorage.getItem('deliveryPersons')) || [];

    document.getElementById('currentDay').textContent = `Día: ${new Date().toLocaleString('es-ES', { weekday: 'long' })}`;

    document.getElementById('orderForm').addEventListener('submit', function(event) {
        event.preventDefault();
        const order = {
            pickup: this.pickup.value,
            cash: parseFloat(this.cash.value),
            deliveryPersonName: document.getElementById('deliveryPersonInput').value,
            orderType: document.getElementById('orderType').value || "Normal",
        };
        orders.push(order);
        localStorage.setItem('orders', JSON.stringify(orders));
        this.reset();
        renderOrders();
        updateDeliveryPersonTables();
        updateStatistics();
    });

    function clearAllOrders() {
        if (confirm("¿Está seguro de que desea eliminar todos los pedidos?")) {
            orders = [];
            localStorage.setItem('orders', JSON.stringify(orders));
            renderOrders();
            updateDeliveryPersonTables();
            updateStatistics();
        }
    }

    function addDeliveryPerson() {
        const deliveryPersonName = document.getElementById('newDeliveryPersonName').value.trim();
        if (deliveryPersonName && !deliveryPersons.includes(deliveryPersonName)) {
            deliveryPersons.push(deliveryPersonName);
            localStorage.setItem('deliveryPersons', JSON.stringify(deliveryPersons));
            updateDeliveryPersonTables();
            document.getElementById('newDeliveryPersonName').value = '';
        } else if (deliveryPersons.includes(deliveryPersonName)) {
            alert("El repartidor ya existe.");
        }
    }

    function updateDeliveryPersonTables() {
        const container = document.getElementById('deliveryPersonTablesContainer');
        container.innerHTML = ''; // Limpiar el contenedor

        deliveryPersons.forEach(name => {
            const table = document.createElement('table');
            table.innerHTML = `
                <thead>
                    <tr>
                        <th>Referencia</th>
                        <th>Costo de Delivery (C$)</th>
                        <th>Tipo de Pedido</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody id="table-${name}"></tbody>
            `;
            container.appendChild(table);
            renderOrdersForDeliveryPerson(name);
        });
    }

    function renderOrdersForDeliveryPerson(name) {
        const tableBody = document.getElementById(`table-${name}`);
        tableBody.innerHTML = '';
        let totalCost = 0;

        orders.forEach(order => {
            if (order.deliveryPersonName === name) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${order.pickup}</td>
                    <td>${order.cash.toFixed(2)} C$</td>
                    <td>${order.orderType}</td>
                    <td>
                        <button onclick="deleteOrder('${order.pickup}')">Eliminar</button>
                        <button onclick="sendOrderToWhatsApp('${order.pickup}', '${order.cash}', '${name}', '${order.orderType}')">Enviar a WhatsApp</button>
                    </td>
                `;
                tableBody.appendChild(row);
                totalCost += order.cash;
            }
        });

        const totalRow = document.createElement('tr');
        totalRow.innerHTML = `<td colspan="2">Total para ${name}:</td><td>${totalCost.toFixed(2)} C$</td><td></td>`;
        tableBody.appendChild(totalRow);
    }

    function sendOrderToWhatsApp(reference, cash, deliveryPerson, orderType) {
        const message = `Nuevo Pedido:\nReferencia: ${reference}\nCosto de Delivery: C$ ${cash.toFixed(2)}\nNombre de Repartidor: ${deliveryPerson}\nTipo de Pedido: ${orderType}`;
        const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(message)}`;
        window.open(whatsappUrl, '_blank');
    }

    function deleteOrder(reference) {
        orders = orders.filter(order => order.pickup !== reference);
        localStorage.setItem('orders', JSON.stringify(orders));
        updateDeliveryPersonTables();
        updateStatistics();
    }

    function calculateTotalEarnings() {
        const totalEarnings = orders.reduce((total, order) => total + order.cash, 0);
        alert(`Total Ganancias del Día: C$ ${totalEarnings.toFixed(2)}`);
    }

    function updateStatistics() {
        const totalOrders = orders.length;
        const totalEarnings = orders.reduce((total, order) => total + order.cash, 0);
        const deliveryPersonCount = {};

        orders.forEach(order => {
            if (deliveryPersonCount[order.deliveryPersonName]) {
                deliveryPersonCount[order.deliveryPersonName]++;
            } else {
                deliveryPersonCount[order.deliveryPersonName] = 1;
            }
        });

        const mostActiveDeliveryPerson = Object.keys(deliveryPersonCount).reduce((a, b) => deliveryPersonCount[a] > deliveryPersonCount[b] ? a : b, '');

        document.getElementById('totalOrders').textContent = `Total de Pedidos: ${totalOrders}`;
        document.getElementById('totalEarnings').textContent = `Total Ganancias: ${totalEarnings.toFixed(2)} C$`;
        document.getElementById('mostActiveDeliveryPerson').textContent = `Repartidor Más Activo: ${mostActiveDeliveryPerson || 'Ninguno'}`;
    }
</script>

</body>
</html>